!function(e){"use strict";class t extends e.Mesh{constructor(t){const o=new i(t),n=new e.PlaneGeometry(.001*o.image.width,.001*o.image.height),r=new e.MeshBasicMaterial({map:o,toneMapped:!1,transparent:!0});function a(e){r.map.dispatchDOMEvent(e)}super(n,r),this.addEventListener("mouseleave",a),this.addEventListener("mousedown",a),this.addEventListener("mousemove",a),this.addEventListener("mouseup",a),this.addEventListener("click",a),this.dispose=function(){n.dispose(),r.dispose(),r.map.dispose(),s.delete(t),this.removeEventListener("mouseleave",a),this.removeEventListener("mousedown",a),this.removeEventListener("mousemove",a),this.removeEventListener("mouseup",a),this.removeEventListener("click",a)}}}class i extends e.CanvasTexture{constructor(t){super(n(t)),this.prevCanvasSize={width:this.image.width,height:this.image.height},this.dom=t,this.anisotropy=16,"147"===THREE.REVISION?this.encoding=e.sRGBEncoding:this.colorSpace=e.SRGBColorSpace,this.minFilter=e.LinearFilter,this.magFilter=e.LinearFilter;const i=new MutationObserver((()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout((()=>this.update()),100))}));i.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.observer=i}dispatchDOMEvent(e){e.data&&function(e,t,i,o){const s={clientX:i*e.offsetWidth+e.offsetLeft,clientY:o*e.offsetHeight+e.offsetTop,view:e.ownerDocument.defaultView},n=e.getBoundingClientRect();function r(e){if(e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE){const n=e.getBoundingClientRect();if(i>n.left&&i<n.right&&o>n.top&&o<n.bottom){if(e.dispatchEvent(new MouseEvent(t,s)),e instanceof HTMLButtonElement&&"mousemove"===t)e.classList.contains("hover")||e.classList.add("hover");if(e instanceof HTMLInputElement&&"range"===e.type&&("mousedown"===t||"click"===t)){const[t,o]=["min","max"].map((t=>parseFloat(e[t]))),s=n.width,r=(i-n.x)/s;e.value=t+(o-t)*r,e.dispatchEvent(new InputEvent("input",{bubbles:!0}))}}else e instanceof HTMLButtonElement&&e.classList.contains("hover")&&e.classList.remove("hover");for(let t=0;t<e.childNodes.length;t++)r(e.childNodes[t])}}i=i*n.width+n.left,o=o*n.height+n.top,r(e)}(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=n(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null,this.image.width===this.prevCanvasSize.width&&this.image.height===this.prevCanvasSize.height||(this.prevCanvasSize.width=this.image.width,this.prevCanvasSize.height=this.image.height,this.dom.dispatchEvent(new CustomEvent("size-changed")))}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const o=["backgroundColor","color","borderRadius","borderTopWidth","borderTopColor","borderTopStyle","borderLeftWidth","borderLeftColor","borderLeftStyle","borderBottomWidth","borderBottomColor","borderBottomStyle","borderRightWidth","borderRightColor","borderRightStyle","accentColor","fontFamily","fontWeight","fontSize","textTransform","paddingLeft","paddingTop","paddingBottom","paddingRight","overflow"],s=new WeakMap;function n(t){const i=document.createRange(),n=new e.Color;function r(e,t,i,o,s){if(""!==o)if("uppercase"===e.textTransform&&(o=o.toUpperCase()),c.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,c.textBaseline="top",c.fillStyle=e.color,s){const n=function(e,t,i){const o=t.split(" "),s=[];let n=o[0];for(let t=1;t<o.length;t++){const r=o[t];e.measureText(n+" "+r).width<i?n+=" "+r:(s.push(n),n=r)}return s.push(n),s}(c,o,s);n.forEach((function(o,s){c.fillText(o,t,i+.1*parseFloat(e.fontSize)+s*parseFloat(e.fontSize)*1.3)}))}else c.fillText(o,t,i+.1*parseFloat(e.fontSize))}function a(e,t,i,o,s){i<2*s&&(s=i/2),o<2*s&&(s=o/2),c.beginPath(),c.moveTo(e+s,t),c.arcTo(e+i,t,e+i,t+o,s),c.arcTo(e+i,t+o,e,t+o,s),c.arcTo(e,t+o,e,t,s),c.arcTo(e,t,e+i,t,s),c.closePath()}function l(e,t,i,o,s,n){const r=e[t+"Width"],a=e[t+"Style"],l=e[t+"Color"];"0px"!==r&&"none"!==a&&"transparent"!==l&&"rgba(0, 0, 0, 0)"!==l&&(c.strokeStyle=l,c.lineWidth=parseFloat(r),c.beginPath(),c.moveTo(i,o),c.lineTo(i+s,o+n),c.stroke())}const h=t.getBoundingClientRect();let d=s.get(t);void 0===d&&(d=document.createElement("canvas"),s.set(t,d)),d.width=h.width,d.height=h.height;const c=d.getContext("2d"),u=new function(e){const t=[];let i=!1;function o(){if(i&&(i=!1,e.restore()),0===t.length)return;let o=-1/0,s=-1/0,n=1/0,r=1/0;for(let e=0;e<t.length;e++){const i=t[e];o=Math.max(o,i.x),s=Math.max(s,i.y),n=Math.min(n,i.x+i.width),r=Math.min(r,i.y+i.height)}e.save(),e.beginPath(),e.rect(o,s,n-o,r-s),e.clip(),i=!0}return{add:function(e){t.push(e),o()},remove:function(){t.pop(),o()}}}(c);return c.clearRect(0,0,d.width,d.height),function e(t,s){let d=0,m=0,p=0,v=0;if(t.nodeType===Node.TEXT_NODE){i.selectNode(t);const e=i.getBoundingClientRect();d=e.left-h.left-.5,m=e.top-h.top-.5,p=e.width,v=e.height;const o=1.01*p;r(s,d,m,t.nodeValue.trim(),o)}else{if(t.nodeType===Node.COMMENT_NODE)return;if(t instanceof HTMLCanvasElement){if("none"===t.style.display)return;const e=t.getBoundingClientRect();d=e.left-h.left-.5,m=e.top-h.top-.5,c.save();const i=window.devicePixelRatio;c.scale(1/i,1/i),c.drawImage(t,d,m),c.restore()}else if(t instanceof HTMLImageElement){if("none"===t.style.display)return;const e=t.getBoundingClientRect();d=e.left-h.left-.5,m=e.top-h.top-.5,p=e.width,v=e.height,c.drawImage(t,d,m,p,v)}else{if("none"===t.style.display)return;const e=t.getBoundingClientRect();d=e.left-h.left-.5,m=e.top-h.top-.5,p=e.width,v=e.height,s=function(e){const t=window.getComputedStyle(e);if(e instanceof HTMLButtonElement&&"true"!==e.dataset.hoverStyleStored)if("pending"!==e.dataset.hoverStyleStored)e.dataset.hoverStyleStored="pending",queueMicrotask((()=>{e.style.transitionDuration="0s",e.classList.add("hover")}));else if(e.classList.contains("hover")){for(const i of o)e.dataset[i]=t[i];e.dataset.hoverStyleStored="true",queueMicrotask((()=>{e.classList.remove("hover")}))}return e.classList.contains("hover")&&"true"===e.dataset.hoverStyleStored?e.dataset:t}(t),a(d,m,p,v,parseFloat(s.borderRadius));const i=s.backgroundColor;"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(c.fillStyle=i,c.fill());const f=["borderTop","borderLeft","borderBottom","borderRight"];let g=!0,y=null;for(const e of f){if(null!==y&&(g=s[e+"Width"]===s[y+"Width"]&&s[e+"Color"]===s[y+"Color"]&&s[e+"Style"]===s[y+"Style"]),!1===g)break;y=e}if(!0===g){const e=parseFloat(s.borderTopWidth);"0px"!==s.borderTopWidth&&"none"!==s.borderTopStyle&&"transparent"!==s.borderTopColor&&"rgba(0, 0, 0, 0)"!==s.borderTopColor&&(c.strokeStyle=s.borderTopColor,c.lineWidth=e,c.stroke())}else l(s,"borderTop",d,m,p,0),l(s,"borderLeft",d,m,0,v),l(s,"borderBottom",d,m+v,p,0),l(s,"borderRight",d+p,m,0,v);if(t instanceof HTMLInputElement){let e=s.accentColor;void 0!==e&&"auto"!==e||(e=s.color),n.set(e);const i=Math.sqrt(.299*n.r**2+.587*n.g**2+.114*n.b**2)<.5?"white":"#111111";if("radio"===t.type&&(a(d,m,p,v,v),c.fillStyle="white",c.strokeStyle=e,c.lineWidth=1,c.fill(),c.stroke(),t.checked&&(a(d+2,m+2,p-4,v-4,v),c.fillStyle=e,c.strokeStyle=i,c.lineWidth=2,c.fill(),c.stroke())),"checkbox"===t.type&&(a(d,m,p,v,2),c.fillStyle=t.checked?e:"white",c.strokeStyle=t.checked?i:e,c.lineWidth=1,c.stroke(),c.fill(),t.checked)){const e=c.textAlign;c.textAlign="center";r({color:i,fontFamily:s.fontFamily,fontSize:v+"px",fontWeight:"bold"},d+p/2,m,"âœ”"),c.textAlign=e}if("range"===t.type){const[o,s,n]=["min","max","value"].map((e=>parseFloat(t[e]))),r=(n-o)/(s-o)*(p-v);a(d,m+v/4,p,v/2,v/4),c.fillStyle=i,c.strokeStyle=e,c.lineWidth=1,c.fill(),c.stroke(),a(d,m+v/4,r+v/2,v/2,v/4),c.fillStyle=e,c.fill(),a(d+r,m,v,v,v/2),c.fillStyle=e,c.fill()}"color"!==t.type&&"text"!==t.type&&"number"!==t.type||(u.add({x:d,y:m,width:p,height:v}),r(s,d+parseInt(s.paddingLeft),m+parseInt(s.paddingTop),t.value),u.remove())}}}const f="auto"===s.overflow||"hidden"===s.overflow;f&&u.add({x:d,y:m,width:p,height:v});for(let i=0;i<t.childNodes.length;i++)e(t.childNodes[i],s);f&&u.remove()}(t),d}const r={type:"",data:new THREE.Vector2};AFRAME.registerComponent("html",{schema:{html:{type:"selector"},cursor:{type:"selector"},xrlayer:{type:"bool",default:!0}},init(){this.rerender=this.rerender.bind(this),this.handle=this.handle.bind(this),this.onClick=e=>this.handle("click",e),this.onMouseLeave=e=>this.handle("mouseleave",e),this.onMouseEnter=e=>this.handle("mouseenter",e),this.onMouseUp=e=>this.handle("mouseup",e),this.onMouseDown=e=>this.handle("mousedown",e),this.mouseMoveDetail={detail:{cursorEl:null,intersection:null}},this.sizeChanged=this.sizeChanged.bind(this)},sizeChanged(){this.update()},play(){this.el.addEventListener("click",this.onClick),this.el.addEventListener("mouseleave",this.onMouseLeave),this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("mousedown",this.onMouseDown),this.data.html.addEventListener("size-changed",this.sizeChanged)},pause(){this.el.removeEventListener("click",this.onClick),this.el.removeEventListener("mouseleave",this.onMouseLeave),this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("mousedown",this.onMouseDown),this.data.html.removeEventListener("size-changed",this.sizeChanged)},update(){if(this.remove(),!this.data.html)return;const e=new t(this.data.html);this.el.setObject3D("html",e),this.data.html.addEventListener("input",this.rerender),this.data.html.addEventListener("change",this.rerender),this.cursor=this.data.cursor?this.data.cursor.object3D:null,this.data.xrlayer&&this.initXRLayer()},tick(){if(this.activeRaycaster){const e=this.activeRaycaster.components.raycaster.getIntersection(this.el);this.mouseMoveDetail.detail.cursorEl=this.activeRaycaster,this.mouseMoveDetail.detail.intersection=e,this.handle("mousemove",this.mouseMoveDetail)}},handle(e,t){const i=t.detail.intersection,o=t.detail.cursorEl;if("mouseenter"===e&&(this.activeRaycaster=o),"mouseleave"===e&&this.activeRaycaster===o){this.activeRaycaster=null,r.type=e,r.data.set(-1,-1);this.el.getObject3D("html").dispatchEvent(r)}if(this.cursor&&(this.cursor.visible=!1),i){const t=this.el.getObject3D("html"),o=i.uv;r.type=e,r.data.set(o.x,1-o.y),t.dispatchEvent(r),this.cursor&&(this.cursor.visible=!0,this.cursor.parent.worldToLocal(this.cursor.position.copy(i.point)))}},rerender(){const e=this.el.getObject3D("html");e&&!e.material.map.scheduleUpdate&&(e.material.map.scheduleUpdate=setTimeout((()=>{e.material.map.update(),this.el.emit("render",{},!0)}),16))},remove(){const e=this.el.getObject3D("html");e&&(this.el.removeObject3D("html"),this.data.html.removeEventListener("input",this.rerender),this.data.html.removeEventListener("change",this.rerender),e.dispose()),this.activeRaycaster=null,this.mouseMoveDetail.detail.cursorEl=null,this.mouseMoveDetail.detail.intersection=null,this.cursor=null},initXRLayer(){this.el.sceneEl.renderer.xr;let e=this.el.getObject3D("html");e&&(this.el.getAttribute("layer")||(this.el.setAttribute("layer",{src:e.material.map.image,width:e.material.map.image.width/1e3,height:e.material.map.image.height/1e3}),e.position.z-=.05),this.el.addEventListener("render",(()=>{let e=this.el.components.layer;e&&(e.loadQuadImage(),e.needsRedraw=!0)})))}})}(THREE);
//# sourceMappingURL=aframe-html.min.js.map
