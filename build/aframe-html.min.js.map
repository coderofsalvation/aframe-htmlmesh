{"version":3,"file":"aframe-html.min.js","sources":["../src/HTMLMesh.js","../src/aframe-html.js"],"sourcesContent":["// This is a copy of https://github.com/mrdoob/three.js/blob/0403020848c26a9605eb91c99a949111ad4a532e/examples/jsm/interactive/HTMLMesh.js\n// with the following changes:\n// - Keep compatibility with three r147 aframe 1.4.2, still using \"this.encoding = sRGBEncoding\", otherwise using \"this.colorSpace = SRGBColorSpace;\"\n// - window.dispatchEvent line commented, see the TODO below.\n// Look at https://github.com/mrdoob/three.js/commits/dev/examples/jsm/interactive/HTMLMesh.js\n// to see if there are other changes that can be retrieved here.\nimport {\n\tCanvasTexture,\n\tLinearFilter,\n\tMesh,\n\tMeshBasicMaterial,\n\tPlaneGeometry,\n\tSRGBColorSpace,\n\tsRGBEncoding,\n\tColor\n} from 'three';\n\nclass HTMLMesh extends Mesh {\n\n\tconstructor( dom ) {\n\n\t\tconst texture = new HTMLTexture( dom );\n\n\t\tconst geometry = new PlaneGeometry( texture.image.width * 0.001, texture.image.height * 0.001 );\n\t\tconst material = new MeshBasicMaterial( { map: texture, toneMapped: false, transparent: true } );\n\n\t\tsuper( geometry, material );\n\n\t\tfunction onEvent( event ) {\n\n\t\t\tmaterial.map.dispatchDOMEvent( event );\n\n\t\t}\n\n\t\tthis.addEventListener( 'mouseleave', onEvent );\n\t\tthis.addEventListener( 'mousedown', onEvent );\n\t\tthis.addEventListener( 'mousemove', onEvent );\n\t\tthis.addEventListener( 'mouseup', onEvent );\n\t\tthis.addEventListener( 'click', onEvent );\n\n\t\tthis.dispose = function () {\n\n\t\t\tgeometry.dispose();\n\t\t\tmaterial.dispose();\n\n\t\t\tmaterial.map.dispose();\n\n\t\t\tcanvases.delete( dom );\n\n\t\t\tthis.removeEventListener( 'mouseleave', onEvent );\n\t\t\tthis.removeEventListener( 'mousedown', onEvent );\n\t\t\tthis.removeEventListener( 'mousemove', onEvent );\n\t\t\tthis.removeEventListener( 'mouseup', onEvent );\n\t\t\tthis.removeEventListener( 'click', onEvent );\n\n\t\t};\n\n\t}\n\n}\n\nclass HTMLTexture extends CanvasTexture {\n\n\tconstructor( dom ) {\n\n\t\tsuper( html2canvas( dom ) );\n\t\tthis.prevCanvasSize = { width: this.image.width, height: this.image.height };\n\n\t\tthis.dom = dom;\n\n\t\tthis.anisotropy = 16;\n\t\tif ( THREE.REVISION === '147' ) { // Keep compatibility with aframe 1.4.2\n\n\t\t\tthis.encoding = sRGBEncoding;\n\n\t\t} else {\n\n\t\t\tthis.colorSpace = SRGBColorSpace;\n\n\t\t}\n\n\t\tthis.minFilter = LinearFilter;\n\t\tthis.magFilter = LinearFilter;\n\n\t\t// Create an observer on the DOM, and run html2canvas update in the next loop\n\t\tconst observer = new MutationObserver( () => {\n\n\t\t\tif ( ! this.scheduleUpdate ) {\n\n\t\t\t\t// ideally should use xr.requestAnimationFrame, here setTimeout to avoid passing the renderer\n\t\t\t\tthis.scheduleUpdate = setTimeout( () => this.update(), 100 );\n\n\t\t\t}\n\n\t\t} );\n\n\t\tconst config = { attributes: true, childList: true, subtree: true, characterData: true };\n\t\tobserver.observe( dom, config );\n\n\t\tthis.observer = observer;\n\n\t}\n\n\tdispatchDOMEvent( event ) {\n\n\t\tif ( event.data ) {\n\n\t\t\thtmlevent( this.dom, event.type, event.data.x, event.data.y );\n\n\t\t}\n\n\t}\n\n\tupdate() {\n\n\t\tthis.image = html2canvas( this.dom );\n\t\tthis.needsUpdate = true;\n\n\t\tthis.scheduleUpdate = null;\n\n\t\tif ( this.image.width !== this.prevCanvasSize.width || this.image.height !== this.prevCanvasSize.height ) {\n\t\t\tthis.prevCanvasSize.width = this.image.width;\n\t\t\tthis.prevCanvasSize.height = this.image.height;\n\t\t\tthis.dom.dispatchEvent(new CustomEvent('size-changed'))\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tif ( this.observer ) {\n\n\t\t\tthis.observer.disconnect();\n\n\t\t}\n\n\t\tthis.scheduleUpdate = clearTimeout( this.scheduleUpdate );\n\n\t\tsuper.dispose();\n\n\t}\n\n}\n\n// Those are all css properties we use in this file:\nconst USED_CSS_PROPERTIES = [\n\t'backgroundColor', 'color',\n\t'borderRadius',\n\t'borderTopWidth', 'borderTopColor', 'borderTopStyle',\n\t'borderLeftWidth', 'borderLeftColor', 'borderLeftStyle',\n\t'borderBottomWidth', 'borderBottomColor', 'borderBottomStyle',\n\t'borderRightWidth', 'borderRightColor', 'borderRightStyle',\n\t'accentColor', 'fontFamily', 'fontWeight', 'fontSize', 'textTransform',\n\t'paddingLeft', 'paddingTop', 'paddingBottom', 'paddingRight',\n\t'overflow'\n];\n\n//\n\nconst canvases = new WeakMap();\n\nfunction html2canvas( element ) {\n\n\tconst range = document.createRange();\n\tconst color = new Color();\n\n\tfunction Clipper( context ) {\n\n\t\tconst clips = [];\n\t\tlet isClipping = false;\n\n\t\tfunction doClip() {\n\n\t\t\tif ( isClipping ) {\n\n\t\t\t\tisClipping = false;\n\t\t\t\tcontext.restore();\n\n\t\t\t}\n\n\t\t\tif ( clips.length === 0 ) return;\n\n\t\t\tlet minX = - Infinity, minY = - Infinity;\n\t\t\tlet maxX = Infinity, maxY = Infinity;\n\n\t\t\tfor ( let i = 0; i < clips.length; i ++ ) {\n\n\t\t\t\tconst clip = clips[ i ];\n\n\t\t\t\tminX = Math.max( minX, clip.x );\n\t\t\t\tminY = Math.max( minY, clip.y );\n\t\t\t\tmaxX = Math.min( maxX, clip.x + clip.width );\n\t\t\t\tmaxY = Math.min( maxY, clip.y + clip.height );\n\n\t\t\t}\n\n\t\t\tcontext.save();\n\t\t\tcontext.beginPath();\n\t\t\tcontext.rect( minX, minY, maxX - minX, maxY - minY );\n\t\t\tcontext.clip();\n\n\t\t\tisClipping = true;\n\n\t\t}\n\n\t\treturn {\n\n\t\t\tadd: function ( clip ) {\n\n\t\t\t\tclips.push( clip );\n\t\t\t\tdoClip();\n\n\t\t\t},\n\n\t\t\tremove: function () {\n\n\t\t\t\tclips.pop();\n\t\t\t\tdoClip();\n\n\t\t\t}\n\n\t\t};\n\n\t}\n\n\tfunction getLines( ctx, text, maxWidth ) {\n\t\tconst words = text.split( \" \" );\n\t\tconst lines = [];\n\t\tlet currentLine = words[0];\n\n\t\tfor (let i = 1; i < words.length; i++) {\n\n\t\t\tconst word = words[i];\n\t\t\tconst width = ctx.measureText( currentLine + \" \" + word ).width;\n\t\t\tif ( width < maxWidth ) {\n\t\t\t\tcurrentLine += \" \" + word;\n\t\t\t} else {\n\t\t\t\tlines.push( currentLine );\n\t\t\t\tcurrentLine = word;\n\t\t\t}\n\t\t}\n\t\tlines.push(currentLine);\n\t\treturn lines;\n\t}\n\n\tfunction drawText( style, x, y, string, maxWidth ) {\n\n\t\tif ( string !== '' ) {\n\n\t\t\tif ( style.textTransform === 'uppercase' ) {\n\n\t\t\t\tstring = string.toUpperCase();\n\n\t\t\t}\n\n\t\t\tcontext.font = style.fontWeight + ' ' + style.fontSize + ' ' + style.fontFamily;\n\t\t\tcontext.textBaseline = 'top';\n\t\t\tcontext.fillStyle = style.color;\n\t\t\tif ( !maxWidth ) {\n\t\t\t\tcontext.fillText( string, x, y + parseFloat( style.fontSize ) * 0.1 );\n\t\t\t} else {\n\t\t\t\tconst lines = getLines(context, string, maxWidth);\n\t\t\t\tlines.forEach(function(line, i) {\n\t\t\t\t\tcontext.fillText( line, x, y + parseFloat( style.fontSize ) * 0.1 + i * parseFloat( style.fontSize ) * 1.3 );\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction buildRectPath( x, y, w, h, r ) {\n\n\t\tif ( w < 2 * r ) r = w / 2;\n\t\tif ( h < 2 * r ) r = h / 2;\n\n\t\tcontext.beginPath();\n\t\tcontext.moveTo( x + r, y );\n\t\tcontext.arcTo( x + w, y, x + w, y + h, r );\n\t\tcontext.arcTo( x + w, y + h, x, y + h, r );\n\t\tcontext.arcTo( x, y + h, x, y, r );\n\t\tcontext.arcTo( x, y, x + w, y, r );\n\t\tcontext.closePath();\n\n\t}\n\n\tfunction drawBorder( style, which, x, y, width, height ) {\n\n\t\tconst borderWidth = style[ which + 'Width' ];\n\t\tconst borderStyle = style[ which + 'Style' ];\n\t\tconst borderColor = style[ which + 'Color' ];\n\n\t\tif ( borderWidth !== '0px' && borderStyle !== 'none' && borderColor !== 'transparent' && borderColor !== 'rgba(0, 0, 0, 0)' ) {\n\n\t\t\tcontext.strokeStyle = borderColor;\n\t\t\tcontext.lineWidth = parseFloat( borderWidth );\n\t\t\tcontext.beginPath();\n\t\t\tcontext.moveTo( x, y );\n\t\t\tcontext.lineTo( x + width, y + height );\n\t\t\tcontext.stroke();\n\n\t\t}\n\n\t}\n\n\tfunction getStyleForElement( element ) {\n\t\tconst style = window.getComputedStyle( element );\n\t\tif ( element instanceof HTMLButtonElement ) {\n\t\t\tif ( element.dataset.hoverStyleStored !== 'true' ) {\n\t\t\t\t// The first time we render, store hover style in data attributes to make\n\t\t\t\t// hover style work in VR because style aren't recomputed when we add the\n\t\t\t\t// hover class.\n\t\t\t\tif ( element.dataset.hoverStyleStored !== 'pending' ) {\n\t\t\t\t\t// The mutation observer won't trigger rerender if we add the class now because we're currently rendering (scheduleUpdate is defined)\n\t\t\t\t\t// Wait end of render before we modify the DOM.\n\t\t\t\t\telement.dataset.hoverStyleStored = 'pending';\n\t\t\t\t\tqueueMicrotask( () => {\n\t\t\t\t\t\t// Disable any css transition to avoir having a\n\t\t\t\t\t\t// background color in between states when rerender is triggered.\n\t\t\t\t\t\telement.style.transitionDuration = '0s';\n\t\t\t\t\t\telement.classList.add( 'hover' );\n\t\t\t\t\t} );\n\t\t\t\t} else if ( element.classList.contains( 'hover' ) ){\n\t\t\t\t\t// rerender was called, now store the updated computed style for hover\n\t\t\t\t\tfor ( const prop of USED_CSS_PROPERTIES ) {\n\t\t\t\t\t\telement.dataset[prop] = style[prop];\n\t\t\t\t\t}\n\t\t\t\t\telement.dataset.hoverStyleStored = 'true';\n\t\t\t\t\tqueueMicrotask( () => {\n\t\t\t\t\t\telement.classList.remove( 'hover' );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn element.classList.contains( 'hover' ) && element.dataset.hoverStyleStored === 'true' ? element.dataset : style;\n\t}\n\n\tfunction drawElement( element, style ) {\n\n\t\tlet x = 0, y = 0, width = 0, height = 0;\n\n\t\tif ( element.nodeType === Node.TEXT_NODE ) {\n\n\t\t\t// text\n\n\t\t\trange.selectNode( element );\n\n\t\t\tconst rect = range.getBoundingClientRect();\n\n\t\t\tx = rect.left - offset.left - 0.5;\n\t\t\ty = rect.top - offset.top - 0.5;\n\t\t\twidth = rect.width;\n\t\t\theight = rect.height;\n\t\t\t// On Quest the font used to draw on canvas is bigger than on\n\t\t\t// the desktop, compensate for this.\n\t\t\tconst maxWidth = width * 1.01; // 1.005 is good, but use 1.01 to be sure\n\n\t\t\tdrawText( style, x, y, element.nodeValue.trim(), maxWidth );\n\n\t\t} else if ( element.nodeType === Node.COMMENT_NODE ) {\n\n\t\t\treturn;\n\n\t\t} else if ( element instanceof HTMLCanvasElement ) {\n\n\t\t\t// Canvas element\n\t\t\tif ( element.style.display === 'none' ) return;\n\n\t\t\tconst rect = element.getBoundingClientRect();\n\n\t\t\tx = rect.left - offset.left - 0.5;\n\t\t\ty = rect.top - offset.top - 0.5;\n\n\t\t        context.save();\n\t\t\tconst dpr = window.devicePixelRatio;\n\t\t\tcontext.scale( 1 / dpr, 1 / dpr );\n\t\t\tcontext.drawImage( element, x, y );\n\t\t\tcontext.restore();\n\n\t\t} else if ( element instanceof HTMLImageElement ) {\n\n\t\t\tif ( element.style.display === 'none' ) return;\n\n\t\t\tconst rect = element.getBoundingClientRect();\n\n\t\t\tx = rect.left - offset.left - 0.5;\n\t\t\ty = rect.top - offset.top - 0.5;\n\t\t\twidth = rect.width;\n\t\t\theight = rect.height;\n\n\t\t\tcontext.drawImage( element, x, y, width, height );\n\n\t\t} else {\n\n\t\t\tif ( element.style.display === 'none' ) return;\n\n\t\t\tconst rect = element.getBoundingClientRect();\n\n\t\t\tx = rect.left - offset.left - 0.5;\n\t\t\ty = rect.top - offset.top - 0.5;\n\t\t\twidth = rect.width;\n\t\t\theight = rect.height;\n\n\t\t\tstyle = getStyleForElement( element );\n\n\t\t\t// Get the border of the element used for fill and border\n\n\t\t\tbuildRectPath( x, y, width, height, parseFloat( style.borderRadius ) );\n\n\t\t\tconst backgroundColor = style.backgroundColor;\n\n\t\t\tif ( backgroundColor !== 'transparent' && backgroundColor !== 'rgba(0, 0, 0, 0)' ) {\n\n\t\t\t\tcontext.fillStyle = backgroundColor;\n\t\t\t\tcontext.fill();\n\n\t\t\t}\n\n\t\t\t// If all the borders match then stroke the round rectangle\n\n\t\t\tconst borders = [ 'borderTop', 'borderLeft', 'borderBottom', 'borderRight' ];\n\n\t\t\tlet match = true;\n\t\t\tlet prevBorder = null;\n\n\t\t\tfor ( const border of borders ) {\n\n\t\t\t\tif ( prevBorder !== null ) {\n\n\t\t\t\t\tmatch = ( style[ border + 'Width' ] === style[ prevBorder + 'Width' ] ) &&\n\t\t\t\t\t( style[ border + 'Color' ] === style[ prevBorder + 'Color' ] ) &&\n\t\t\t\t\t( style[ border + 'Style' ] === style[ prevBorder + 'Style' ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( match === false ) break;\n\n\t\t\t\tprevBorder = border;\n\n\t\t\t}\n\n\t\t\tif ( match === true ) {\n\n\t\t\t\t// They all match so stroke the rectangle from before allows for border-radius\n\n\t\t\t\tconst width = parseFloat( style.borderTopWidth );\n\n\t\t\t\tif ( style.borderTopWidth !== '0px' && style.borderTopStyle !== 'none' && style.borderTopColor !== 'transparent' && style.borderTopColor !== 'rgba(0, 0, 0, 0)' ) {\n\n\t\t\t\t\tcontext.strokeStyle = style.borderTopColor;\n\t\t\t\t\tcontext.lineWidth = width;\n\t\t\t\t\tcontext.stroke();\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// Otherwise draw individual borders\n\n\t\t\t\tdrawBorder( style, 'borderTop', x, y, width, 0 );\n\t\t\t\tdrawBorder( style, 'borderLeft', x, y, 0, height );\n\t\t\t\tdrawBorder( style, 'borderBottom', x, y + height, width, 0 );\n\t\t\t\tdrawBorder( style, 'borderRight', x + width, y, 0, height );\n\n\t\t\t}\n\n\t\t\tif ( element instanceof HTMLInputElement ) {\n\n\t\t\t\tlet accentColor = style.accentColor;\n\n\t\t\t\tif ( accentColor === undefined || accentColor === 'auto' ) accentColor = style.color;\n\n\t\t\t\tcolor.set( accentColor );\n\n\t\t\t\tconst luminance = Math.sqrt( 0.299 * ( color.r ** 2 ) + 0.587 * ( color.g ** 2 ) + 0.114 * ( color.b ** 2 ) );\n\t\t\t\tconst accentTextColor = luminance < 0.5 ? 'white' : '#111111';\n\n\t\t\t\tif ( element.type === 'radio' ) {\n\n\t\t\t\t\tbuildRectPath( x, y, width, height, height );\n\n\t\t\t\t\tcontext.fillStyle = 'white';\n\t\t\t\t\tcontext.strokeStyle = accentColor;\n\t\t\t\t\tcontext.lineWidth = 1;\n\t\t\t\t\tcontext.fill();\n\t\t\t\t\tcontext.stroke();\n\n\t\t\t\t\tif ( element.checked ) {\n\n\t\t\t\t\t\tbuildRectPath( x + 2, y + 2, width - 4, height - 4, height );\n\n\t\t\t\t\t\tcontext.fillStyle = accentColor;\n\t\t\t\t\t\tcontext.strokeStyle = accentTextColor;\n\t\t\t\t\t\tcontext.lineWidth = 2;\n\t\t\t\t\t\tcontext.fill();\n\t\t\t\t\t\tcontext.stroke();\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( element.type === 'checkbox' ) {\n\n\t\t\t\t\tbuildRectPath( x, y, width, height, 2 );\n\n\t\t\t\t\tcontext.fillStyle = element.checked ? accentColor : 'white';\n\t\t\t\t\tcontext.strokeStyle = element.checked ? accentTextColor : accentColor;\n\t\t\t\t\tcontext.lineWidth = 1;\n\t\t\t\t\tcontext.stroke();\n\t\t\t\t\tcontext.fill();\n\n\t\t\t\t\tif ( element.checked ) {\n\n\t\t\t\t\t\tconst currentTextAlign = context.textAlign;\n\n\t\t\t\t\t\tcontext.textAlign = 'center';\n\n\t\t\t\t\t\tconst properties = {\n\t\t\t\t\t\t\tcolor: accentTextColor,\n\t\t\t\t\t\t\tfontFamily: style.fontFamily,\n\t\t\t\t\t\t\tfontSize: height + 'px',\n\t\t\t\t\t\t\tfontWeight: 'bold'\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tdrawText( properties, x + ( width / 2 ), y, 'âœ”' );\n\n\t\t\t\t\t\tcontext.textAlign = currentTextAlign;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( element.type === 'range' ) {\n\n\t\t\t\t\tconst [ min, max, value ] = [ 'min', 'max', 'value' ].map( property => parseFloat( element[ property ] ) );\n\t\t\t\t\tconst position = ( ( value - min ) / ( max - min ) ) * ( width - height );\n\n\t\t\t\t\tbuildRectPath( x, y + ( height / 4 ), width, height / 2, height / 4 );\n\t\t\t\t\tcontext.fillStyle = accentTextColor;\n\t\t\t\t\tcontext.strokeStyle = accentColor;\n\t\t\t\t\tcontext.lineWidth = 1;\n\t\t\t\t\tcontext.fill();\n\t\t\t\t\tcontext.stroke();\n\n\t\t\t\t\tbuildRectPath( x, y + ( height / 4 ), position + ( height / 2 ), height / 2, height / 4 );\n\t\t\t\t\tcontext.fillStyle = accentColor;\n\t\t\t\t\tcontext.fill();\n\n\t\t\t\t\tbuildRectPath( x + position, y, height, height, height / 2 );\n\t\t\t\t\tcontext.fillStyle = accentColor;\n\t\t\t\t\tcontext.fill();\n\n\t\t\t\t}\n\n\t\t\t\tif ( element.type === 'color' || element.type === 'text' || element.type === 'number' ) {\n\n\t\t\t\t\tclipper.add( { x: x, y: y, width: width, height: height } );\n\n\t\t\t\t\tdrawText( style, x + parseInt( style.paddingLeft ), y + parseInt( style.paddingTop ), element.value );\n\n\t\t\t\t\tclipper.remove();\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t/*\n\t\t// debug\n\t\tcontext.strokeStyle = '#' + Math.random().toString( 16 ).slice( - 3 );\n\t\tcontext.strokeRect( x - 0.5, y - 0.5, width + 1, height + 1 );\n\t\t*/\n\n\t\tconst isClipping = style.overflow === 'auto' || style.overflow === 'hidden';\n\n\t\tif ( isClipping ) clipper.add( { x: x, y: y, width: width, height: height } );\n\n\t\tfor ( let i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tdrawElement( element.childNodes[ i ], style );\n\n\t\t}\n\n\t\tif ( isClipping ) clipper.remove();\n\n\t}\n\n\tconst offset = element.getBoundingClientRect();\n\n\tlet canvas = canvases.get( element );\n\n\tif ( canvas === undefined ) {\n\n\t\tcanvas = document.createElement( 'canvas' );\n\t\tcanvases.set( element, canvas );\n\n\t}\n\n\tcanvas.width = offset.width;\n\tcanvas.height = offset.height;\n\n\tconst context = canvas.getContext( '2d'/*, { alpha: false }*/ );\n\n\tconst clipper = new Clipper( context );\n\n\t// console.time( 'drawElement' );\n\n\tcontext.clearRect(0, 0, canvas.width, canvas.height);\n\n\tdrawElement( element );\n\n\t// console.timeEnd( 'drawElement' );\n\n\treturn canvas;\n\n}\n\nfunction htmlevent( element, event, x, y ) {\n\n\tconst mouseEventInit = {\n\t\tclientX: ( x * element.offsetWidth ) + element.offsetLeft,\n\t\tclientY: ( y * element.offsetHeight ) + element.offsetTop,\n\t\tview: element.ownerDocument.defaultView\n\t};\n\n\t// TODO: Find out why this is added. Keep commented out when this file is updated\n\t// window.dispatchEvent( new MouseEvent( event, mouseEventInit ) );\n\n\tconst rect = element.getBoundingClientRect();\n\n\tx = x * rect.width + rect.left;\n\ty = y * rect.height + rect.top;\n\n\tfunction traverse( element ) {\n\n\t\tif ( element.nodeType !== Node.TEXT_NODE && element.nodeType !== Node.COMMENT_NODE ) {\n\n\t\t\tconst rect = element.getBoundingClientRect();\n\n\t\t\tif ( x > rect.left && x < rect.right && y > rect.top && y < rect.bottom ) {\n\n\t\t\t\telement.dispatchEvent( new MouseEvent( event, mouseEventInit ) );\n\n\t\t\t\tif ( element instanceof HTMLButtonElement ) {\n\t\t\t\t\tswitch ( event ) {\n\t\t\t\t\t\tcase 'mousemove':\n\t\t\t\t\t\t\tif ( !element.classList.contains( 'hover' ) ) {\n\t\t\t\t\t\t\t\telement.classList.add('hover');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( element instanceof HTMLInputElement && element.type === 'range' && ( event === 'mousedown' || event === 'click' ) ) {\n\n\t\t\t\t\tconst [ min, max ] = [ 'min', 'max' ].map( property => parseFloat( element[ property ] ) );\n\n\t\t\t\t\tconst width = rect.width;\n\t\t\t\t\tconst offsetX = x - rect.x;\n\t\t\t\t\tconst proportion = offsetX / width;\n\t\t\t\t\telement.value = min + ( max - min ) * proportion;\n\t\t\t\t\telement.dispatchEvent( new InputEvent( 'input', { bubbles: true } ) );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif ( element instanceof HTMLButtonElement ) {\n\t\t\t\t\tif ( element.classList.contains( 'hover' ) ) element.classList.remove( 'hover' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor ( let i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\t\ttraverse( element.childNodes[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttraverse( element );\n\n}\n\nexport { HTMLMesh };\n","/* jshint esversion: 9, -W097 */\n/* For dealing with spline curves */\n/* global THREE, AFRAME, setTimeout, console */\n'use strict';\n\nimport { HTMLMesh } from './HTMLMesh.js';\n\nconst schemaHTML = {\n\thtml: {\n\t\ttype: 'selector',\n\t},\n\tcursor: {\n\t\ttype: 'selector',\n\t},\n  xrlayer:{\n    type:'bool',\n    default: true\n  }\n};\n\ndocumentation:\n{\n\tschemaHTML.html.description = `HTML element to use.`;\n\tschemaHTML.cursor.description = `Visual indicator for where the user is currently pointing`;\n\tschemaHTML.xrlayer.description = `Render via XR Layer for better performance and readability`;\n}\n\nconst _pointer = new THREE.Vector2();\nconst _event = { type: '', data: _pointer };\nAFRAME.registerComponent('html', {\n\tschema: schemaHTML,\n\tinit() {\n\t\tthis.rerender = this.rerender.bind(this);\n\t\tthis.handle = this.handle.bind(this);\n\t\tthis.onClick = e => this.handle('click', e);\n\t\tthis.onMouseLeave = e => this.handle('mouseleave', e);\n\t\tthis.onMouseEnter = e => this.handle('mouseenter', e);\n\t\tthis.onMouseUp = e => this.handle('mouseup', e);\n\t\tthis.onMouseDown = e => this.handle('mousedown', e);\n\t\tthis.mouseMoveDetail = {\n\t\t\tdetail: {\n\t\t\t\tcursorEl: null,\n\t\t\t\tintersection: null\n\t\t\t}\n\t\t};\n\t\tthis.sizeChanged = this.sizeChanged.bind(this);\n\t},\n\tsizeChanged() {\n\t\tthis.update();\n\t},\n\tplay() {\n\t\tthis.el.addEventListener('click', this.onClick);\n\t\tthis.el.addEventListener('mouseleave', this.onMouseLeave);\n\t\tthis.el.addEventListener('mouseenter', this.onMouseEnter);\n\t\tthis.el.addEventListener('mouseup', this.onMouseUp);\n\t\tthis.el.addEventListener('mousedown', this.onMouseDown);\n\t\tthis.data.html.addEventListener('size-changed', this.sizeChanged)\n\t},\n\tpause() {\n\t\tthis.el.removeEventListener('click', this.onClick);\n\t\tthis.el.removeEventListener('mouseleave', this.onMouseLeave);\n\t\tthis.el.removeEventListener('mouseenter', this.onMouseEnter);\n\t\tthis.el.removeEventListener('mouseup', this.onMouseUp);\n\t\tthis.el.removeEventListener('mousedown', this.onMouseDown);\n\t\tthis.data.html.removeEventListener('size-changed', this.sizeChanged)\n\t},\n\tupdate() {\n\t\tthis.remove();\n\t\tif (!this.data.html) return;\n\t\tconst mesh = new HTMLMesh(this.data.html);\n\t\tthis.el.setObject3D('html', mesh);\n\t\tthis.data.html.addEventListener('input', this.rerender);\n\t\tthis.data.html.addEventListener('change', this.rerender);\n\t\tthis.cursor = this.data.cursor ? this.data.cursor.object3D : null;\n    if( this.data.xrlayer ) this.initXRLayer()\n\t},\n\ttick() {\n\t\tif (this.activeRaycaster) {\n\t\t\tconst intersection = this.activeRaycaster.components.raycaster.getIntersection(this.el);\n\t\t\tthis.mouseMoveDetail.detail.cursorEl = this.activeRaycaster;\n\t\t\tthis.mouseMoveDetail.detail.intersection = intersection;\n\t\t\tthis.handle('mousemove', this.mouseMoveDetail);\n\t\t}\n\t},\n\thandle(type, evt) {\n\t\tconst intersection = evt.detail.intersection;\n\t\tconst raycaster = evt.detail.cursorEl;\n\t\tif (type === 'mouseenter') {\n\t\t\tthis.activeRaycaster = raycaster;\n\t\t}\n\t\tif (type === 'mouseleave' && this.activeRaycaster === raycaster) {\n\t\t\tthis.activeRaycaster = null;\n\t\t\t_event.type = type;\n\t\t\t_event.data.set( -1, -1 );\n\t\t\tconst mesh = this.el.getObject3D('html');\n\t\t\tmesh.dispatchEvent( _event );\n\t\t}\n\t\tif (this.cursor) this.cursor.visible = false;\n\t\tif (intersection) {\n\t\t\tconst mesh = this.el.getObject3D('html');\n\t\t\tconst uv = intersection.uv;\n\t\t\t_event.type = type;\n\t\t\t_event.data.set( uv.x, 1 - uv.y );\n\t\t\tmesh.dispatchEvent( _event );\n\n\t\t\tif (this.cursor) {\n\t\t\t\tthis.cursor.visible = true;\n\t\t\t\tthis.cursor.parent.worldToLocal(this.cursor.position.copy(intersection.point));\n\t\t\t}\n\t\t}\n\t},\n\trerender() {\n\t\tconst mesh = this.el.getObject3D('html');\n\t\tif (mesh && !mesh.material.map.scheduleUpdate) {\n\t\t\tmesh.material.map.scheduleUpdate = setTimeout( () => {\n        mesh.material.map.update()\n        this.el.emit('render',{},true)\n      }, 16 );\n\t\t}\n\t},\n\tremove() {\n\t\tconst mesh = this.el.getObject3D('html');\n\t\tif (mesh) {\n\t\t\tthis.el.removeObject3D('html');\n\t\t\tthis.data.html.removeEventListener('input', this.rerender);\n\t\t\tthis.data.html.removeEventListener('change', this.rerender);\n\t\t\tmesh.dispose();\n\t\t}\n\t\tthis.activeRaycaster = null;\n\t\tthis.mouseMoveDetail.detail.cursorEl = null;\n\t\tthis.mouseMoveDetail.detail.intersection = null;\n\t\tthis.cursor = null;\n\t},\n  initXRLayer() {\n    let sceneEl  = this.el.sceneEl;\n    let xr       = sceneEl.renderer.xr\n    let mesh     = this.el.getObject3D('html')\n    let retry_ms = 300\n    if( !mesh ) return \n\n    if( !this.el.getAttribute('layer') ){\n      this.el.setAttribute('layer',{\n        src:    mesh.material.map.image, \n        width:  mesh.material.map.image.width/1000,\n        height: mesh.material.map.image.height/1000\n      })\n      mesh.position.z -= 0.05\n    }\n\n    this.el.addEventListener('render', () => {\n      let layer = this.el.components.layer\n      if(!layer) return\n      layer.loadQuadImage()\n      layer.needsRedraw = true;\n    })\n  }\n});\n"],"names":["HTMLMesh","Mesh","constructor","dom","texture","HTMLTexture","geometry","PlaneGeometry","image","width","height","material","MeshBasicMaterial","map","toneMapped","transparent","onEvent","event","dispatchDOMEvent","super","this","addEventListener","dispose","canvases","delete","removeEventListener","CanvasTexture","html2canvas","prevCanvasSize","anisotropy","THREE","REVISION","encoding","sRGBEncoding","colorSpace","SRGBColorSpace","minFilter","LinearFilter","magFilter","observer","MutationObserver","scheduleUpdate","setTimeout","update","observe","attributes","childList","subtree","characterData","data","element","x","y","mouseEventInit","clientX","offsetWidth","offsetLeft","clientY","offsetHeight","offsetTop","view","ownerDocument","defaultView","rect","getBoundingClientRect","traverse","nodeType","Node","TEXT_NODE","COMMENT_NODE","left","right","top","bottom","dispatchEvent","MouseEvent","HTMLButtonElement","classList","contains","add","HTMLInputElement","type","min","max","property","parseFloat","proportion","value","InputEvent","bubbles","remove","i","childNodes","length","htmlevent","needsUpdate","CustomEvent","disconnect","clearTimeout","USED_CSS_PROPERTIES","WeakMap","range","document","createRange","color","Color","drawText","style","string","maxWidth","textTransform","toUpperCase","context","font","fontWeight","fontSize","fontFamily","textBaseline","fillStyle","lines","ctx","text","words","split","currentLine","word","measureText","push","getLines","forEach","line","fillText","buildRectPath","w","h","r","beginPath","moveTo","arcTo","closePath","drawBorder","which","borderWidth","borderStyle","borderColor","strokeStyle","lineWidth","lineTo","stroke","offset","canvas","get","undefined","createElement","set","getContext","clipper","clips","isClipping","doClip","restore","minX","Infinity","minY","maxX","maxY","clip","Math","save","pop","clearRect","drawElement","selectNode","nodeValue","trim","HTMLCanvasElement","display","dpr","window","devicePixelRatio","scale","drawImage","HTMLImageElement","getComputedStyle","dataset","hoverStyleStored","queueMicrotask","transitionDuration","prop","getStyleForElement","borderRadius","backgroundColor","fill","borders","match","prevBorder","border","borderTopWidth","borderTopStyle","borderTopColor","accentColor","accentTextColor","sqrt","g","b","checked","currentTextAlign","textAlign","position","parseInt","paddingLeft","paddingTop","overflow","_event","Vector2","AFRAME","registerComponent","schema","html","cursor","xrlayer","default","init","rerender","bind","handle","onClick","e","onMouseLeave","onMouseEnter","onMouseUp","onMouseDown","mouseMoveDetail","detail","cursorEl","intersection","sizeChanged","play","el","pause","mesh","setObject3D","object3D","initXRLayer","tick","activeRaycaster","components","raycaster","getIntersection","evt","getObject3D","visible","uv","parent","worldToLocal","copy","point","emit","removeObject3D","sceneEl","renderer","xr","getAttribute","setAttribute","src","z","layer","loadQuadImage","needsRedraw"],"mappings":"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"}